{"version":3,"sources":["../../src/pages/login/login.module.ts","../../src/pages/login/login.ts"],"names":[],"mappings":"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","file":"11.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LoginPage } from './login';\n\n@NgModule({\n  declarations: [\n    LoginPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LoginPage),\n  ],\n})\nexport class LoginPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.module.ts","import { Component } from '@angular/core';\r\nimport { AppVersion } from '@ionic-native/app-version';\r\nimport { IonicPage, NavController, NavParams, AlertController, Platform, LoadingController } from 'ionic-angular';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { AriagroDataProvider } from '../../providers/ariagro-data/ariagro-data';\r\nimport { LocalDataProvider } from '../../providers/local-data/local-data';\r\nimport { ViewController } from 'ionic-angular';\r\nimport { OneSignal } from '@ionic-native/onesignal';\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-login',\r\n  templateUrl: 'login.html',\r\n})\r\nexport class LoginPage {\r\n settings: any = {};\r\n  version: string = \"ARIAGRO APP V2\";\r\n  loginForm: FormGroup;\r\n  submitAttempt: boolean = false;\r\n  login: string = \"\";\r\n  password: string = \"\";\r\n  nombreCooperativa: string = \"LA COOPPP\";\r\n\r\n  constructor(public navCtrl: NavController,  public appVersion: AppVersion, public navParams: NavParams, public plt: Platform, public loadingCtrl: LoadingController,\r\n    public formBuilder: FormBuilder, public alertCrtl: AlertController, public viewCtrl: ViewController,\r\n    public ariagroData: AriagroDataProvider, public localData: LocalDataProvider, public oneSignal: OneSignal) {\r\n    this.loginForm = formBuilder.group({\r\n      login: ['', Validators.compose([Validators.required])],\r\n      password: ['', Validators.compose([Validators.required])]\r\n    });\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    this.localData.getSettings().then(data => {\r\n      if (data) {\r\n        this.settings = JSON.parse(data);\r\n        this.nombreCooperativa = this.settings.parametros.nombre;\r\n        this.viewCtrl.setBackButtonText('');\r\n      } else {\r\n        this.navCtrl.setRoot('ParametrosPage');\r\n      }\r\n    });\r\n    try {\r\n      this.appVersion.getVersionNumber().then(vrs => {\r\n        this.version = \"ARIAGRO APP V\" + vrs;\r\n      },\r\n        error => {\r\n          // NO hacemos nada, en realidad protegemos al estar en debug\r\n          // con el navegador\r\n        });\r\n    } catch (error) {\r\n\r\n    }\r\n  }\r\n\r\n  doLogin(): void {\r\n    this.submitAttempt = true;\r\n    if (this.loginForm.valid) {\r\n      this.ariagroData.login(this.settings.parametros.url, this.login, this.password)\r\n        .subscribe(\r\n          (data) => {\r\n            this.settings.user = data;\r\n            this.ariagroData.getCampanyaActual(this.settings.parametros.url)\r\n            .subscribe(\r\n              (data) => {\r\n                this.settings.campanya = data[0];\r\n                this.localData.saveSettings(this.settings);\r\n                this.pushUser(this.settings.user);\r\n                this.navCtrl.setRoot('HomePage');\r\n              },\r\n              (error) => {\r\n                if (error.status == 404) {\r\n                  this.showAlert(\"AVISO\", \"Usuario o contraseña incorrectos\");\r\n                } else {\r\n                  this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n                }\r\n              }\r\n            );\r\n          },\r\n          (error) => {\r\n            if (error.status == 404) {\r\n              this.showAlert(\"AVISO\", \"Usuario o contraseña incorrectos\");\r\n            } else {\r\n              this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n            }\r\n          }\r\n        );\r\n    }\r\n  }\r\n\r\n\r\n\r\n  pushUser(user) {\r\n    this.plt.ready().then(() => {\r\n      // obtener los parámetros\r\n      let loading = this.loadingCtrl.create({ content: 'Buscando mensajes...' });\r\n      loading.present();\r\n      this.ariagroData.getParametros(this.settings.parametros.url)\r\n        .subscribe(\r\n          (data) => {\r\n            loading.dismiss();\r\n\r\n            var config = this.settings;\r\n            config.paramPush = data\r\n\r\n            this.localData.saveSettings(config)\r\n\r\n            try {\r\n              // Registro OneSignal\r\n              this.oneSignal.startInit(config.paramPush.appId, config.paramPush.gcm);\r\n              this.oneSignal.getIds().then((ids) => {\r\n                var myUser = this.settings.user;\r\n\r\n                //alert(JSON.stringify(ids));\r\n                if (config.user.playerId != ids.userId) {\r\n\r\n                  myUser.playerId = ids.userId;\r\n                  this.ariagroData.putUsuario(this.settings.parametros.url, myUser.usuarioPushId, myUser)\r\n                    .subscribe((data) => {\r\n                      this.settings.user = data;\r\n                    },\r\n                      (err) => {\r\n                        loading.dismiss();\r\n                        console.log(\"PUT usuario error\");\r\n                      });\r\n                }\r\n              },\r\n                (error) => {\r\n                  if (error.status == 404) {\r\n                    this.showAlert(\"AVISO\", \"Usuario o contraseña incorrectos\");\r\n                  } \r\n                });\r\n              this.oneSignal.endInit();\r\n            } catch (e) {\r\n              console.log(\"Error de carga de oneSignal\");\r\n            }\r\n\r\n          },\r\n          (err) => {\r\n            loading.dismiss();\r\n            if (err) {\r\n              var msg = err || err.message;\r\n              this.showAlert(\"ERROR\", msg);\r\n            }\r\n          });\r\n    });\r\n  }\r\n\r\n\r\n  goConexion(): any {\r\n    this.navCtrl.push('ParametrosPage');\r\n  }\r\n\r\n  goHome(): any {\r\n    this.navCtrl.setRoot('HomePage');\r\n  }\r\n\r\n  showAlert(title, subTitle): void {\r\n    let alert = this.alertCrtl.create({\r\n      title: title,\r\n      subTitle: subTitle,\r\n      buttons: ['OK']\r\n    });\r\n    alert.present();\r\n  }\r\n\r\n\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.ts"],"sourceRoot":""}