{"version":3,"sources":["../../src/pages/modal-calidades-albaran/modal-calidades-albaran.module.ts","../../src/pages/modal-calidades-albaran/modal-calidades-albaran.ts"],"names":[],"mappings":"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","file":"9.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ModalCalidadesAlbaranPage } from './modal-calidades-albaran';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ModalCalidadesAlbaranPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ModalCalidadesAlbaranPage),\r\n  ],\r\n})\r\nexport class ModalCalidadesAlbaranPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/modal-calidades-albaran/modal-calidades-albaran.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, ViewController, AlertController, LoadingController  } from 'ionic-angular';\r\nimport { AriagroDataProvider } from '../../providers/ariagro-data/ariagro-data';\r\nimport { LocalDataProvider } from '../../providers/local-data/local-data';\r\nimport * as numeral from 'numeral';\r\n\r\n\r\n\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-modal-calidades-albaran',\r\n  templateUrl: 'modal-calidades-albaran.html',\r\n})\r\nexport class ModalCalidadesAlbaranPage {\r\n\r\n  settings: any = {};\r\n  campanya: any = {};\r\n  user: any = {};\r\n  entrada: any = {};\r\n  calidades: any = [];\r\n  incidencias: any = [];\r\n  loading: any;\r\n  correo: any;\r\n  usaInformes: any;\r\n\r\n  constructor(public navCtrl: NavController, public navParams: NavParams, public viewCtrl: ViewController,\r\n     public localData: LocalDataProvider, public alertCrtl: AlertController, public loadingCtrl: LoadingController, \r\n     public ariagroData: AriagroDataProvider) {\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    this.localData.getSettings().then(data => {\r\n      if (data) {\r\n        this.settings = JSON.parse(data);\r\n        this.viewCtrl.setBackButtonText('');\r\n        this.user = this.settings.user;\r\n        this.usaInformes = this.settings.parametros.usaInformes;\r\n        //renovar configuración de usuario\r\n        this.ariagroData.login(this.settings.parametros.url, this.user.login, this.user.password)\r\n        .subscribe(\r\n          (data) => {\r\n            this.settings.user = data;\r\n            this.user = this.settings.user;\r\n            this.localData.saveSettings(this.settings);\r\n            this.campanya = this.settings.campanya;\r\n            this.entrada = this.navParams.get('entrada');\r\n            this.correo = this.settings.user.email;\r\n            this.loadCalidades();\r\n          },\r\n          (error) => {\r\n            if (error.status == 404) {\r\n              this.showAlert(\"AVISO\", \"Usuario o contraseña incorrectos\");\r\n            } else {\r\n              this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n            }\r\n          }\r\n        );\r\n      } else {\r\n        this.navCtrl.setRoot('ParametrosPage');\r\n      }\r\n    });\r\n  }\r\n\r\n  loadCalidades(): void {\r\n    let loading = this.loadingCtrl.create({ content: 'Buscando clasificacion...' });\r\n    loading.present();\r\n    this.ariagroData.getAlbaranClasificacion(this.settings.parametros.url, this.entrada.numalbar, this.campanya.ariagro)\r\n    .subscribe(\r\n      (data) => {\r\n        loading.dismiss();\r\n        this.calidades = this.prepareData(data[0]);\r\n        this.incidencias = this.prepareIncidencias(data[1]);\r\n      },\r\n      (error) => {\r\n        loading.dismiss();\r\n        this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n      }\r\n    );\r\n  }\r\n\r\n  prepareData(calidades): any {\r\n    var contador = 1;\r\n    calidades.forEach(a => {\r\n      if(a.kilos != null) {\r\n        a.contador = contador++;\r\n        a.kilos = numeral(a.kilos).format('0,0');\r\n      }\r\n    });\r\n    return calidades;\r\n  }\r\n\r\n  prepareIncidencias(incidencias): any {\r\n    var contador = 1;\r\n    incidencias.forEach(a => {\r\n        a.contador = contador++;\r\n      });\r\n    return incidencias;\r\n  }\r\n\r\n  \r\n\r\n  comprobarCorreo(): void {\r\n    if(this.usaInformes == 0) {\r\n      this.showAlert('', 'Funcionalidad no habilitada, póngase en contacto con su cooperativa');\r\n    }else {\r\n      var mens = \"\";\r\n      var emailRegex = /^[-\\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\\.){1,125}[A-Z]{2,63}$/i;\r\n   \r\n      if (emailRegex.test(this.correo)) {\r\n        mens = 'Este es el correo al cual se va a enviar la clasificación. Puede introducir otro.';\r\n      } else {\r\n        mens = 'Correo incorrecto, introduzca un correo.';\r\n      }\r\n      this.mostrarCorreo(mens);\r\n    }\r\n  }\r\n\r\n  enviarCorreo(ruta): void {\r\n    this.ariagroData.enviarCorreoClasif(this.settings.parametros.url, this.entrada.numalbar, this.correo, ruta, this.campanya.nomempre)\r\n      .subscribe(\r\n        (data) => {\r\n          this.loading.dismiss();\r\n\r\n          this.showAlert(\"\", JSON.stringify('MENSAJE ENVIADO', null, 4));\r\n          if( this.settings.user.email == \"\"){\r\n            this.correo = null;\r\n          }\r\n          \r\n        },\r\n        (error) => {\r\n          this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n          this.loading.dismiss();\r\n        }\r\n      );\r\n  }\r\n\r\n  \r\n  mostrarCorreo(mens) {\r\n    let alert = this.alertCrtl.create({\r\n      title: mens,\r\n      inputs: [\r\n        {\r\n          name: 'Correo',\r\n          value:  this.correo\r\n        },\r\n      ],\r\n      buttons: [\r\n        {\r\n          text: 'Cancelar',\r\n          role: 'cancel',\r\n          handler: data => {\r\n            console.log('Cancel clicked');\r\n          }\r\n        },\r\n        {\r\n          text: 'Aceptar',\r\n          handler: data => {\r\n            var emailRegex = /^[-\\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\\.){1,125}[A-Z]{2,63}$/i;\r\n   \r\n            if (emailRegex.test(data.Correo)) {\r\n              this.correo = data.Correo;\r\n              this.loading = this.loadingCtrl.create({ content: 'Enviando correo...' });\r\n              this.loading.present();\r\n              this.ariagroData.prepararCorreoClasif(this.settings.parametros.url, this.entrada.numalbar, this.campanya.ariagro, this.settings.parametros.infClasificacion)\r\n              .subscribe(\r\n                (data) => {\r\n                  this.enviarCorreo(data);\r\n                },\r\n                (error) => {\r\n                  this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n                  this.loading.dismiss();\r\n                }\r\n              );\r\n            }else {\r\n              mens = 'Correo incorrecto, introduzca un correo';\r\n              this.mostrarCorreo(mens);\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    alert.present();\r\n  }\r\n\r\n  showAlert(title, subTitle): void {\r\n    let alert = this.alertCrtl.create({\r\n      title: title,\r\n      subTitle: subTitle,\r\n      buttons: ['OK']\r\n    });\r\n    alert.present();\r\n  }\r\n\r\n  dismiss(): void {\r\n    this.viewCtrl.dismiss();\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/modal-calidades-albaran/modal-calidades-albaran.ts"],"sourceRoot":""}